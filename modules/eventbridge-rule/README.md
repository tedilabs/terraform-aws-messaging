# eventbridge-rule

This module creates following resources.

- `aws_cloudwatch_event_rule`
- `aws_cloudwatch_event_target` (optional)

<!-- BEGIN_TF_DOCS -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.6 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | >= 5.27 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | 5.31.0 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_resource_group"></a> [resource\_group](#module\_resource\_group) | tedilabs/misc/aws//modules/resource-group | ~> 0.10.0 |
| <a name="module_role"></a> [role](#module\_role) | tedilabs/account/aws//modules/iam-role | ~> 0.28.0 |

## Resources

| Name | Type |
|------|------|
| [aws_cloudwatch_event_rule.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_event_rule) | resource |
| [aws_cloudwatch_event_target.api_destination](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_event_target) | resource |
| [aws_cloudwatch_event_target.aws_service](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_event_target) | resource |
| [aws_cloudwatch_event_target.event_bus](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_event_target) | resource |
| [aws_caller_identity.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/caller_identity) | data source |
| [aws_iam_policy_document.event_bus](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |
| [aws_iam_policy_document.ssm_run_command](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |
| [aws_iam_policy_document.ssm_run_commands](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |
| [aws_partition.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/partition) | data source |
| [aws_region.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/region) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_name"></a> [name](#input\_name) | (Required) A name of the rule for the event bus. | `string` | n/a | yes |
| <a name="input_api_destination_targets"></a> [api\_destination\_targets](#input\_api\_destination\_targets) | (Optional) The configuration to manage the specified EventBridge API destination targets for the rule. Each item of `api_destination_targets` as defined below.<br>    (Required) `id` - The unique ID of the target within the specified rule. Use this ID to reference the target when updating the rule.<br>    (Required) `api_destination` - The Amazon Resource Name (ARN) of the target API destination.<br><br>    (Optional) `input` - The input to send to the target. `input` as defined below.<br>      (Optional) `type` - Valid values are `MATCHED_EVENT`, `CONSTANT`, `JSON_PATH`, `TRNASFORMER`. Defaults to `MATCHED_EVENT`.<br>      (Optional) `value` - The input value to send to the target. Not required if `input.type` is `MATCHED_EVENT`.<br>        `CONSTANT` - Valid JSON text passed to the target.<br>        `JSON_PATH` - A JSON path expression that selects a portion of the event data to pass to the target.<br>        `TRANSFORMER` - The input transformer feature of EventBridge customizes the text from an event before it is passed to the target. You can define variables that use JSON path to reference values in the original event source.<br>      (Optional) `reference_variables` - A map of key-value pairs specified in the form of JSONPath (for example, `time = $.time`). Define variables that use JSON path to reference values in the original event source. Can define up to 100 variables. Only required if `input.type` is `TRANSFORMER`.<br><br>    (Optional) `execution_role` - The ARN (Amazon Resource Name) of the IAM role to be used for this target when the rule is triggered. Only required if `default_execution_role.enabled` is `false`.<br><br>    (Optional) `dead_letter_queue` - The configuration for dead-letter queue of the rule target. Dead letter queues are used for collecting and storing events that were not successfully delivered to targets. `dead_letter_queue` as defined below.<br>      (Optional) `enabled` - Whether to enable the dead letter queue. Defaults to `false`.<br>      (Optional) `sqs_queue` - The Amazon Resource Name (ARN) of the SQS queue specified as the target for the dead letter queue.<br>    (Optional) `retry_policy` - The configuration for retry policy of the rule target. Retry policies are used for specifying how many times to retry sending an event to a target after an error occurs. `retry_policy` as defined below.<br>      (Optional) `maximum_event_age` - The maximum amount of time, in seconds, to continue to make retry attempts. Defaults to `86400` (1 hour).<br>      (Optional) `maximum_retry_attempts` - The maximum number of times to retry sending an event to a target after an error occurs. Defaults to `185`. | <pre>list(object({<br>    id              = string<br>    api_destination = string<br><br>    input = optional(object({<br>      type                = optional(string, "MATCHED_EVENT")<br>      value               = optional(string)<br>      reference_variables = optional(map(string), {})<br>    }), {})<br><br>    execution_role = optional(string)<br><br>    dead_letter_queue = optional(object({<br>      enabled   = optional(bool, false)<br>      sqs_queue = optional(string)<br>    }), {})<br>    retry_policy = optional(object({<br>      maximum_event_age      = optional(number, 86400)<br>      maximum_retry_attempts = optional(number, 185)<br>    }), {})<br>  }))</pre> | `[]` | no |
| <a name="input_aws_service_targets"></a> [aws\_service\_targets](#input\_aws\_service\_targets) | (Optional) The configuration to manage the specified AWS service targets for the rule. Targets are the resources that are invoked when a rule is triggered. Each item of `aws_service_targets` as defined below.<br>    (Required) `id` - The unique ID of the target within the specified rule. Use this ID to reference the target when updating the rule.<br>    (Required) `type` - The AWS resource type of the target. Valid values are<br>  `CLOUDWATCH_LOG_GROUP`, `SNS_TOPIC`, `SQS_QUEUE`, `SSM_RUN_COMMAND`.<br>    (Optional) `cloudwatch_log_group` - The configuration for CloudWatch log group target. `cloudwatch_log_group` as defined below.<br>      (Required) `arn` - The Amazon Resource Name (ARN) of the CloudWatch log group.<br>    (Optional) `sns_topic` - The configuration for SNS topic target. `sns_topic` as defined below.<br>      (Required) `arn` - The Amazon Resource Name (ARN) of the SNS topic.<br>    (Optional) `sqs_queue` - The configuration for SQS queue target. `sqs_queue` as defined below.<br>      (Required) `arn` - The Amazon Resource Name (ARN) of the SQS queue.<br>      (Optional) `message_group_id` - The FIFO message group ID to use as the target.<br>    (Optional) `ssm_run_command` - The configuration for SSM run command target. `ssm_run_command` as defined below.<br>      (Required) `document` - The Amazon Resource Name (ARN) of the SSM document to run on the target.<br>      (Required) `target_selector` - The target selector as a Map of key-value pairs. Valid keys are `InstanceIds` or `tag:${tag-name}`.<br><br>    (Optional) `input` - The input to send to the target. `input` as defined below.<br>      (Optional) `type` - Valid values are `MATCHED_EVENT`, `CONSTANT`, `JSON_PATH`, `TRNASFORMER`, `CHATBOT_CUSTOM_NOTIFICATION`. Defaults to `MATCHED_EVENT`.<br>      (Optional) `value` - The input value to send to the target. Not required if `input.type` is `MATCHED_EVENT`.<br>        `CONSTANT` - Valid JSON text passed to the target.<br>        `JSON_PATH` - A JSON path expression that selects a portion of the event data to pass to the target.<br>        `TRANSFORMER` - The input transformer feature of EventBridge customizes the text from an event before it is passed to the target. You can define variables that use JSON path to reference values in the original event source.<br>        `CHATBOT_CUSTOM_NOTIFICATION` - The extended version of `TRANSFORMER` input type.<br>      (Optional) `reference_variables` - A map of key-value pairs specified in the form of JSONPath (for example, `time = $.time`). Define variables that use JSON path to reference values in the original event source. Can define up to 100 variables. Only required if `input.type` is `TRANSFORMER` or `CHATBOT_CUSTOM_NOTIFICATION`.<br><br>    (Optional) `execution_role` - The ARN (Amazon Resource Name) of the IAM role to be used for this target when the rule is triggered. Only required if `default_execution_role.enabled` is `false`.<br><br>    (Optional) `dead_letter_queue` - The configuration for dead-letter queue of the rule target. Dead letter queues are used for collecting and storing events that were not successfully delivered to targets. `dead_letter_queue` as defined below.<br>      (Optional) `enabled` - Whether to enable the dead letter queue. Defaults to `false`.<br>      (Optional) `sqs_queue` - The Amazon Resource Name (ARN) of the SQS queue specified as the target for the dead letter queue.<br>    (Optional) `retry_policy` - The configuration for retry policy of the rule target. Retry policies are used for specifying how many times to retry sending an event to a target after an error occurs. `retry_policy` as defined below.<br>      (Optional) `maximum_event_age` - The maximum amount of time, in seconds, to continue to make retry attempts. Defaults to `86400` (1 hour).<br>      (Optional) `maximum_retry_attempts` - The maximum number of times to retry sending an event to a target after an error occurs. Defaults to `185`. | <pre>list(object({<br>    id   = string<br>    type = string<br>    cloudwatch_log_group = optional(object({<br>      arn = string<br>    }))<br>    sns_topic = optional(object({<br>      arn = string<br>    }))<br>    sqs_queue = optional(object({<br>      arn              = string<br>      message_group_id = optional(string)<br>    }))<br>    ssm_run_command = optional(object({<br>      document        = string<br>      target_selector = map(list(string))<br>    }))<br><br>    input = optional(object({<br>      type                = optional(string, "MATCHED_EVENT")<br>      value               = optional(string)<br>      reference_variables = optional(map(string), {})<br>    }), {})<br><br>    execution_role = optional(string)<br><br>    dead_letter_queue = optional(object({<br>      enabled   = optional(bool, false)<br>      sqs_queue = optional(string)<br>    }), {})<br>    retry_policy = optional(object({<br>      maximum_event_age      = optional(number, 86400)<br>      maximum_retry_attempts = optional(number, 185)<br>    }), {})<br>  }))</pre> | `[]` | no |
| <a name="input_default_execution_role"></a> [default\_execution\_role](#input\_default\_execution\_role) | (Optional) A configuration for the default execution role to use for the rule that is used for target invocation. Use `execution_role` if `default_execution_role.enabled` is `false`. `default_execution_role` as defined below.<br>    (Optional) `enabled` - Whether to create the default execution role. Defaults to `true`.<br>    (Optional) `name` - The name of the default execution role. Defaults to `aws-eventbridge-${var.event_bus}-rule-${var.name}`.<br>    (Optional) `path` - The path of the default execution role. Defaults to `/`.<br>    (Optional) `description` - The description of the default execution role.<br>    (Optional) `policies` - A list of IAM policy ARNs to attach to the default execution role. Defaults to `[]`.<br>    (Optional) `inline_policies` - A Map of inline IAM policies to attach to the default execution role. (`name` => `policy`). | <pre>object({<br>    enabled     = optional(bool, true)<br>    name        = optional(string)<br>    path        = optional(string, "/")<br>    description = optional(string, "Managed by Terraform.")<br><br>    policies        = optional(list(string), [])<br>    inline_policies = optional(map(string), {})<br>  })</pre> | `{}` | no |
| <a name="input_description"></a> [description](#input\_description) | (Optional) The description of the rule. | `string` | `"Managed by Terraform."` | no |
| <a name="input_event_bus"></a> [event\_bus](#input\_event\_bus) | (Optional) The name or ARN of the event bus to associate with this rule. If you omit this, the `default` event bus is used. | `string` | `"default"` | no |
| <a name="input_event_bus_targets"></a> [event\_bus\_targets](#input\_event\_bus\_targets) | (Optional) The configuration to manage the specified EventBridge event bus targets for the rule. Each item of `event_bus_targets` as defined below.<br>    (Required) `id` - The unique ID of the target within the specified rule. Use this ID to reference the target when updating the rule.<br>    (Required) `event_bus` - The Amazon Resource Name (ARN) of the target event bus.<br><br>    (Optional) `execution_role` - The ARN (Amazon Resource Name) of the IAM role to be used for this target when the rule is triggered. Only required if `default_execution_role.enabled` is `false`.<br><br>    (Optional) `dead_letter_queue` - The configuration for dead-letter queue of the rule target. Dead letter queues are used for collecting and storing events that were not successfully delivered to targets. `dead_letter_queue` as defined below.<br>      (Optional) `enabled` - Whether to enable the dead letter queue. Defaults to `false`.<br>      (Optional) `sqs_queue` - The Amazon Resource Name (ARN) of the SQS queue specified as the target for the dead letter queue. | <pre>list(object({<br>    id        = string<br>    event_bus = string<br><br>    execution_role = optional(string)<br><br>    dead_letter_queue = optional(object({<br>      enabled   = optional(bool, false)<br>      sqs_queue = optional(string)<br>    }), {})<br>  }))</pre> | `[]` | no |
| <a name="input_execution_role"></a> [execution\_role](#input\_execution\_role) | (Optional) The ARN (Amazon Resource Name) of the IAM role associated with the rule that is used for target invocation. Only required if `default_execution_role.enabled` is `false`. | `string` | `null` | no |
| <a name="input_module_tags_enabled"></a> [module\_tags\_enabled](#input\_module\_tags\_enabled) | (Optional) Whether to create AWS Resource Tags for the module informations. | `bool` | `true` | no |
| <a name="input_resource_group_description"></a> [resource\_group\_description](#input\_resource\_group\_description) | (Optional) The description of Resource Group. | `string` | `"Managed by Terraform."` | no |
| <a name="input_resource_group_enabled"></a> [resource\_group\_enabled](#input\_resource\_group\_enabled) | (Optional) Whether to create Resource Group to find and group AWS resources which are created by this module. | `bool` | `true` | no |
| <a name="input_resource_group_name"></a> [resource\_group\_name](#input\_resource\_group\_name) | (Optional) The name of Resource Group. A Resource Group name can have a maximum of 127 characters, including letters, numbers, hyphens, dots, and underscores. The name cannot start with `AWS` or `aws`. | `string` | `""` | no |
| <a name="input_state"></a> [state](#input\_state) | (Optional) The state of the rule. Valid values are `DISABLED`, `ENABLED`, and `ENABLED_WITH_ALL_CLOUDTRAIL_MANAGEMENT_EVENTS`. Defaults to `ENABLED`.<br>    `DISABLED` - The rule is disabled. EventBridge does not match any events against the rule.<br>    `ENABLED` - The rule is enabled. EventBridge matches events against the rule, except for Amazon Web Services management events delivered through CloudTrail.<br>    `ENABLED_WITH_ALL_CLOUDTRAIL_MANAGEMENT_EVENTS` - The rule is enabled for all events, including Amazon Web Services management events delivered through CloudTrail. Management events provide visibility into management operations that are performed on resources in your Amazon Web Services account. These are also known as control plane operations. This value is only valid for rules on the default event bus or custom event buses. It does not apply to partner event buses. | `string` | `"ENABLED"` | no |
| <a name="input_tags"></a> [tags](#input\_tags) | (Optional) A map of tags to add to all resources. | `map(string)` | `{}` | no |
| <a name="input_trigger"></a> [trigger](#input\_trigger) | (Required) The configuration for the rule trigger. At least one of `schedule_expression` or `event_pattern` is required. `trigger` as defined below.<br>    (Optional) `event_pattern` - The event pattern to trigger when an event matching the pattern occurs. This is described in a JSON object. The `event_pattern` size is 2048 by default but it is adjustable up to 4096 characters by submitting a service quota increase request.<br>    (Optional) `schedule_expression` - The scheduling expression. For example, `cron(0 20 * * ? *)` or `rate(5 minutes)`. Can only be used on the default event bus. | <pre>object({<br>    event_pattern       = optional(string)<br>    schedule_expression = optional(string)<br>  })</pre> | `{}` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_api_destination_targets"></a> [api\_destination\_targets](#output\_api\_destination\_targets) | The configuration for EventBridge API destination targets of the rule. |
| <a name="output_arn"></a> [arn](#output\_arn) | The Amazon Resource Name (ARN) of the rule. |
| <a name="output_aws_service_targets"></a> [aws\_service\_targets](#output\_aws\_service\_targets) | The configuration for AWS service targets of the rule. |
| <a name="output_description"></a> [description](#output\_description) | The description of the rule. |
| <a name="output_event_bus"></a> [event\_bus](#output\_event\_bus) | The name of the event bus. |
| <a name="output_event_bus_targets"></a> [event\_bus\_targets](#output\_event\_bus\_targets) | The configuration for EventBridge event bus targets of the rule. |
| <a name="output_execution_role"></a> [execution\_role](#output\_execution\_role) | The ARN (Amazon Resource Name) of the IAM role associated with the rule that is used for target invocation. |
| <a name="output_id"></a> [id](#output\_id) | The unique identifier for the rule. |
| <a name="output_name"></a> [name](#output\_name) | The name of the rule. |
| <a name="output_state"></a> [state](#output\_state) | The state of the rule. |
| <a name="output_trigger"></a> [trigger](#output\_trigger) | The configuration for the rule trriger. |
<!-- END_TF_DOCS -->
